<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>technical-report</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="technical-report_files/libs/clipboard/clipboard.min.js"></script>
<script src="technical-report_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="technical-report_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="technical-report_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="technical-report_files/libs/quarto-html/popper.min.js"></script>
<script src="technical-report_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="technical-report_files/libs/quarto-html/anchor.min.js"></script>
<link href="technical-report_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="technical-report_files/libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="technical-report_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="technical-report_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="technical-report_files/libs/bootstrap/bootstrap-d6a003b94517c951b2d65075d42fb01b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">




<p><strong>LAPORAN TEKNIS TUGAS KELOMPOK ANALISIS NUMERIK</strong></p>
<p><strong>Studi Penggunaan Bézier Curves dalam Pembuatan Ilustrasi Gambar yang Sudah Ada</strong></p>
<p>[IMAGE: Logo Universitas Indonesia - Makara Kuning]</p>
<p><strong>Disusun oleh Kelompok C10:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Nama</th>
<th style="text-align: left;">NPM</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Argya Farel Kasyara</td>
<td style="text-align: left;">2306152424</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alexander William Lim</td>
<td style="text-align: left;">2306207505</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Jason Kent Winata</td>
<td style="text-align: left;">2206081313</td>
</tr>
<tr class="even">
<td style="text-align: left;">Daffa Abhipraya Putra</td>
<td style="text-align: left;">2306245131</td>
</tr>
</tbody>
</table>
<p><strong>Fakultas Ilmu Komputer</strong> <strong>Universitas Indonesia</strong> <strong>2025</strong></p>
<hr>
<p>[IMAGE: Tanda Tangan Argya Farel Kasyara] [IMAGE: Tanda Tangan Alexander William Lim] [IMAGE: Tanda Tangan Jason Kent Winata] [IMAGE: Tanda Tangan Daffa Abhipraya Putra]</p>
<p><em>“Dengan ini, kami menyatakan bahwa tugas ini adalah hasil pekerjaan kelompok sendiri.”</em></p>
<p><strong>Argya Farel Kasyara</strong> 2306152424</p>
<p><strong>Alexander William Lim</strong> 2306207505</p>
<p><strong>Jason Kent Winata</strong> 2206081313</p>
<p><strong>Daffa Abhipraya Putra</strong> 2306245131</p>
<hr>
<section id="rangkuman" class="level1">
<h1>Rangkuman</h1>
<p>Laporan ini membahas implementasi metode numerik untuk merepresentasikan gambar raster menjadi ilustrasi vektor menggunakan kurva Bézier kubik. Pendekatan yang digunakan adalah <em>Least Squares Fitting</em> untuk mencocokkan kurva dengan kontur gambar yang diekstraksi menggunakan deteksi tepi Canny. Hasil akhir berupa berkas keluaran standar PDF yang di render dari kurva Bézier tersebut.</p>
<hr>
</section>
<section id="daftar-isi" class="level1">
<h1>Daftar Isi</h1>
<ol type="1">
<li><strong>Pendahuluan</strong>…………………………………………………………………………. 1 1.1 Latar Belakang…………………………………………………………………….. 1 1.2 Rumusan Masalah………………………………………………………………… 1 1.3 Tujuan Penulisan…………………………………………………………………. 1 1.4 Batasan Masalah………………………………………………………………….. 1</li>
<li><strong>Dasar Teori</strong>……………………………………………………………………………. 2 2.1 Dasar Teori…………………………………………………………………………. 2 2.2 Least Square Fitting……………………………………………………………… 2</li>
<li><strong>Metodologi Eksperimen</strong>…………………………………………………………… 2 3.1 Pengolahan Citra (Image Processing)……………………………………… 2 3.2 Fitting Kurva Rekursif…………………………………………………………… 3 3.3 Pembuatan PDF…………………………………………………………………… 4</li>
<li><strong>Hasil dan Analisis</strong>…………………………………………………………………… 4</li>
<li><strong>Kesimpulan</strong>…………………………………………………………………………… 6</li>
</ol>
<p><strong>Daftar Referensi</strong>………………………………………………………………………….. 6 <strong>Lampiran</strong>…………………………………………………………………………………… 6</p>
<hr>
</section>
<section id="pendahuluan" class="level1">
<h1>1. Pendahuluan</h1>
<section id="latar-belakang" class="level2">
<h2 class="anchored" data-anchor-id="latar-belakang">1.1 Latar Belakang</h2>
<p>Kurva Bézier merupakan salah satu primitif grafis terpenting dalam <em>Computer Assisted Design</em> (CAD) dan grafis vektor. Kemampuannya untuk memodelkan bentuk lengkung yang halus dengan hanya beberapa titik kontrol menjadikannya sangat efisien dibandingkan dengan representasi poligon atau raster. Dalam proyek ini, kami mengeksplorasi bagaimana mengonversi citra raster statis menjadi representasi matematis menggunakan kurva Bézier, sebuah proses yang dikenal sebagai <em>vectorization</em> atau <em>image tracing</em>.</p>
</section>
<section id="rumusan-masalah" class="level2">
<h2 class="anchored" data-anchor-id="rumusan-masalah">1.2 Rumusan Masalah</h2>
<p>Permasalahan utama yang dikaji adalah:</p>
<ol type="1">
<li>Bagaimana mengekstraksi titik-titik data yang merepresentasikan bentuk dari sebuah citra raster?</li>
<li>Bagaimana mencocokkan (<em>fit</em>) kurva Bézier kubik pada sekumpulan titik data tersebut dengan galat yang minimal?</li>
<li>Bagaimana cara menghasilkan berkas keluaran standar (PDF) yang dapat memvisualisasikan hasil kurva tersebut?</li>
</ol>
</section>
<section id="tujuan-penulisan" class="level2">
<h2 class="anchored" data-anchor-id="tujuan-penulisan">1.3 Tujuan Penulisan</h2>
<ol type="1">
<li>Bagaimana mengekstraksi titik-titik data yang merepresentasikan bentuk dari sebuah citra raster?</li>
<li>Bagaimana mencocokkan (<em>fit</em>) kurva Bézier kubik pada sekumpulan titik data tersebut dengan galat yang minimal?</li>
<li>Bagaimana menghasilkan berkas keluaran standar (PDF) yang dapat memvisualisasikan hasil kurva tersebut?</li>
</ol>
</section>
<section id="batasan-masalah" class="level2">
<h2 class="anchored" data-anchor-id="batasan-masalah">1.4 Batasan Masalah</h2>
<ul>
<li>Kurva yang digunakan adalah Bézier kubik (derajat 3).</li>
<li>Masukan berupa citra raster (PNG/JPG).</li>
<li>Keluaran berupa berkas PDF.</li>
</ul>
<hr>
</section>
</section>
<section id="dasar-teori" class="level1">
<h1>2. Dasar Teori</h1>
<section id="dasar-teori-1" class="level2">
<h2 class="anchored" data-anchor-id="dasar-teori-1">2.1 Dasar Teori</h2>
<p>Kurva Bézier derajat <span class="math inline">\(n\)</span> didefinisikan oleh persamaan parametrik menggunakan polinomial Bernstein:</p>
<p><span class="math display">\[B(t)=\sum_{i=0}^n \binom{n}{i} (1-t)^{n-i} t^i P_i, \quad 0 \le t \le 1\]</span></p>
<p>Untuk kasus Cubic Bézier <span class="math inline">\((n=3)\)</span>, persamaannya adalah:</p>
<p><span class="math display">\[B(t)=(1-t)^3 P_0 + 3(1-t)^2 t P_1 + 3(1-t)t^2 P_2 + t^3 P_3\]</span></p>
<p>Representasi ini menjamin bahwa kurva dimulai di <span class="math inline">\(P_0\)</span> (saat <span class="math inline">\(t=0\)</span>) dan berakhir di <span class="math inline">\(P_3\)</span> (saat <span class="math inline">\(t=1\)</span>). Garis singgung di <span class="math inline">\(P_0\)</span> searah dengan vektor <span class="math inline">\(\vec{P_0P_1}\)</span>, dan di <span class="math inline">\(P_3\)</span> searah dengan <span class="math inline">\(\vec{P_2P_3}\)</span>.</p>
</section>
<section id="least-square-fitting" class="level2">
<h2 class="anchored" data-anchor-id="least-square-fitting">2.2 Least Square Fitting</h2>
<p>Untuk mencocokkan kurva Bézier pada sekumpulan titik data <span class="math inline">\(D_0, D_1, \dots, D_k\)</span>, kita perlu mencari titik kontrol <span class="math inline">\(P_1\)</span> dan <span class="math inline">\(P_2\)</span> (dengan <span class="math inline">\(P_0\)</span> dan <span class="math inline">\(P_3\)</span> tetap di ujung segmen) yang meminimalkan jumlah kuadrat galat:</p>
<p><span class="math display">\[E=\sum_{j=0}^k |B(t_j)-D_j|^2\]</span></p>
<p>Masalah ini dapat diselesaikan dengan menurunkan fungsi <span class="math inline">\(E\)</span> terhadap komponen <span class="math inline">\(P_1\)</span> dan <span class="math inline">\(P_2\)</span>, yang menghasilkan sistem persamaan linear.</p>
</section>
</section>
<section id="metodologi-eksperimen" class="level1">
<h1>3. Metodologi Eksperimen</h1>
<section id="pengolahan-citra-image-processing" class="level2">
<h2 class="anchored" data-anchor-id="pengolahan-citra-image-processing">3.1 Pengolahan Citra (Image Processing)</h2>
<p>Kami menggunakan pustaka <code>cv2</code> (OpenCV) untuk tahap pra-pemrosesan. Awalnya, kami menggunakan <em>binary thresholding</em>, namun metode ini kurang <em>robust</em> terhadap gambar dengan kontras rendah atau latar belakang putih. Oleh karena itu, kami beralih menggunakan <em>Canny Edge Detection</em>. Metode Canny mendeteksi tepi berdasarkan gradien intensitas, sehingga mampu menangkap kontur logo dengan lebih akurat terlepas dari warna latar belakangnya.</p>
<hr>
</section>
<section id="fitting-kurva-rekursif" class="level2">
<h2 class="anchored" data-anchor-id="fitting-kurva-rekursif">3.2 Fitting Kurva Rekursif</h2>
<p>Algoritma utama kami (<code>curve_fitter.py</code>) bekerja secara rekursif:</p>
<ol type="1">
<li>Mencoba mencocokkan satu kurva Bézier pada sekumpulan titik kontur.</li>
<li>Menghitung galat maksimum antara kurva hasil fitting dengan titik asli.</li>
<li>Jika galat melebihi ambang batas (<em>threshold</em>), segmen titik dibagi dua pada titik dengan galat terbesar, dan proses diulang untuk kedua bagian tersebut.</li>
</ol>
<p><strong>Pseudocode:</strong></p>
<pre class="text"><code>Algorithm: Recursive Curve Fitting
Input: List of points, Error threshold
Output: List of Bezier curves

1. Check Base Case:
   If the number of points is less than 2:
       Return an empty list (cannot fit a curve).

2. Initial Fit:
   Attempt to fit a single cubic Bezier curve to the current set of
   points using Least Squares.

3. Error Calculation:
   Calculate the maximum distance (error) between the fitted curve and
   the original points.
   Identify the point index where this maximum error occurs.

4. Decision:
   If the maximum error is within the threshold:
       Return the single fitted curve.
   Else (error is too high):
       Split the points into two subsets at the index of maximum error:
           Left Subset: Points from start to split index.
           Right Subset: Points from split index to end.
       Recursively call this algorithm for the Left Subset.
       Recursively call this algorithm for the Right Subset.
       Return the combined results (Left Curves + Right Curves).</code></pre>
</section>
<section id="pembuatan-pdf" class="level2">
<h2 class="anchored" data-anchor-id="pembuatan-pdf">3.3 Pembuatan PDF</h2>
<p>Kami mengembangkan generator PDF (<code>pdf_generator.py</code>) yang meng-render kurva Bézier ke dalam citra raster menggunakan pustaka OpenCV. Hal ini dilakukan untuk mempermudah visualisasi hasil langsung. Kami menggunakan fungsi <code>cv2.polylines</code> dengan antialiasing untuk memastikan kualitas garis yang halus.</p>
<p><strong>Pseudocode:</strong></p>
<pre class="text"><code>Algorithm: Generate PDF
Input: List of Bezier curves, Output filename

1. Initialize PDF Structure:
   Create a list to hold PDF content lines.
   Write the PDF Header ("%PDF-1.4").

2. Create PDF Objects:
   Create the Catalog Object (referencing the Pages object).
   Create the Pages Object (referencing the Page object).
   Create the Page Object (defining media box and referencing content stream).

3. Construct Content Stream:
   Initialize an empty string for the stream data.
   For each curve in the list:
       Get the start point (P0).
       Append "Move To" command (m) for P0 to the stream.
       Get control points (P1, P2, P3).
       Append "Curve To" command (c) using P1, P2, P3 to the stream.
       Append "Stroke" command (S) to draw the path.

4. Finalize PDF:
   Write the Content Stream Object (containing the stream data).
   Write the Cross-Reference Table (xref) calculating byte offsets for each object.
   Write the Trailer (pointing to the Root object).
   Write the End-of-File marker ("%%EOF").

5. Output:
   Write all PDF content to the specified filename.</code></pre>
<hr>
</section>
</section>
<section id="hasil-dan-analisis" class="level1">
<h1>4. Hasil dan Analisis</h1>
<p><strong>I. Masukan dan Keluaran Bézier Curves</strong></p>
<ul>
<li><strong>Masukan:</strong> Sekumpulan titik kontrol <span class="math inline">\(P_0, P_1, P_2, P_3\)</span> dan parameter <span class="math inline">\(t \in [0, 1]\)</span>.</li>
<li><strong>Keluaran:</strong> Koordinat titik <span class="math inline">\((x,y)\)</span> pada kurva.</li>
</ul>
<p><strong>II. Representasi Matematis</strong></p>
<p>Seperti dijelaskan pada Dasar Teori, kurva direpresentasikan oleh kombinasi linear dari basis Bernstein. Sifat <em>convex hull</em> menjamin kurva selalu berada dalam poligon yang dibentuk oleh titik-titik kontrolnya.</p>
<p><strong>III. Implementasi Program “Freehand Draw”</strong> (Bagian ini kosong dalam dokumen asli)</p>
<p><strong>IV.</strong> (Bagian ini kosong dalam dokumen asli)</p>
<p><strong>V.</strong> Program 3.7 pada buku Timothy Sauer menggunakan pendekatan interpolasi. Implementasi kami memperluas konsep ini dengan menggunakan fitting. Dimana Sauer menggunakan interpolasi spline yang melewati setiap titik, kami menggunakan aproksimasi <em>Least Squares</em> yang lebih efisien untuk data yang rapat (seperti piksel kontur), sehingga kami dapat menghasilkan kurva yang halus tanpa osilasi berlebih.</p>
<p><strong>Contoh Perhitungan Analitik</strong></p>
<p>Misalkan <span class="math inline">\(P_0=(0,0)\)</span>, <span class="math inline">\(P_1=(2,5)\)</span>, <span class="math inline">\(P_2=(8,5)\)</span>, <span class="math inline">\(P_3=(10,0)\)</span>. Untuk <span class="math inline">\(t=0.5\)</span>:</p>
<p><span class="math display">\[B(0.5)=0.125(0,0)+0.375(2,5)+0.375(8,5)+0.125(10,0)\]</span></p>
<p><span class="math inline">\(x=0.75+3+1.25=5\)</span> <span class="math inline">\(y=1.875+1.875=3.75\)</span></p>
<p>Hasil: <span class="math inline">\((5, 3.75)\)</span>.</p>
<p><strong>Perbandingan Kualitas, Akurasi, Efisiensi Keluaran</strong></p>
<p><strong>A. Gambar Non Gradien</strong></p>
<p>Kami melakukan percobaan pada dua gambar logo berwarna polos yang berbeda: Makara UI (kompleks) dan Logo Superbank (sederhana). Berikut adalah masukan, keluaran, dan data hasil pemrosesan:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Input</th>
<th>Output</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[IMAGE: Logo Makara UI Kuning Original]</td>
<td>[IMAGE: Logo Makara UI Outline/Vector Result]</td>
</tr>
<tr class="even">
<td>[IMAGE: Logo Superbank Hijau Original]</td>
<td>[IMAGE: Logo Superbank Outline/Vector Result]</td>
</tr>
</tbody>
</table>
<p><em>Gambar 4.1 Perbandingan Masukkan dan Keluaran Makara UI</em> <em>Gambar 4.2 Perbandingan Masukkan dan Keluaran Logo Superbank</em></p>
<p><strong>Tabel 4.1 Perbandingan Spesifikasi Makara UI dan Logo Superbank</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Metrik</th>
<th style="text-align: left;">Makara UI (makara.png)</th>
<th style="text-align: left;">Logo Superbank (superbank.png)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Dimensi Gambar</td>
<td style="text-align: left;"><span class="math inline">\(1890 \times 2065\)</span> piksel</td>
<td style="text-align: left;"><span class="math inline">\(512 \times 512\)</span> piksel</td>
</tr>
<tr class="even">
<td style="text-align: left;">Total Kontur</td>
<td style="text-align: left;">46</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total Titik Asli</td>
<td style="text-align: left;">74,615 titik</td>
<td style="text-align: left;">2,546 titik</td>
</tr>
<tr class="even">
<td style="text-align: left;">Total Kurva Bézier</td>
<td style="text-align: left;">797 kurva</td>
<td style="text-align: left;">37 kurva</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Rasio Kompresi</td>
<td style="text-align: left;">1 kurva per 93.62 titik</td>
<td style="text-align: left;">1 kurva per 68.81 titik</td>
</tr>
</tbody>
</table>
<p><strong>Analisis:</strong></p>
<ul>
<li><strong>Efisiensi Representasi:</strong> Pada logo Makara yang sangat kompleks dengan lebih dari 74 ribu titik kontur, algoritma kami mampu merepresentasikan sebagian besar gambar hanya dengan 797 kurva Bézier. Ini menunjukkan rasio kompresi yang sangat tinggi (1:93), di mana satu kurva halus dapat menggantikan hampir 100 titik diskrit.</li>
<li><strong>Kompleksitas vs.&nbsp;Jumlah Kurva:</strong> Jumlah kurva yang dihasilkan berbanding lurus dengan kompleksitas visual dan jumlah kontur objek. Logo Superbank yang lebih geometris dan sederhana membutuhkan jauh lebih sedikit kurva dibandingkan logo Makara yang memiliki banyak lekukan detail.</li>
<li><strong>Kualitas Visual:</strong> Secara keseluruhan, hasil visualisasi PDF menunjukkan bahwa kurva yang dihasilkan mampu mengaproksimasi kontur asli dengan sangat halus, memvalidasi efektivitas metode <em>Least Squares Fitting</em> yang diterapkan. Hal ini terbukti pada rekonstruksi logo Superbank yang memiliki tingkat kesesuaian tinggi dengan citra aslinya. Namun, keterbatasan algoritma terlihat pada geometri yang lebih kompleks seperti logo Makara UI, di mana terdapat detail yang gagal terdeteksi sehingga menghasilkan rekonstruksi gambar yang tidak utuh.</li>
</ul>
<p><strong>B. Gambar dengan Gradien</strong></p>
<p>Selanjutnya, kami juga melakukan percobaan pada dua gambar logo berwarna gradien yang berbeda: Firefox (kompleks) dan Messenger (sederhana). Berikut adalah masukan, keluaran, dan data hasil pemrosesan:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Input</th>
<th>Output</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[IMAGE: Logo Firefox Original]</td>
<td>[IMAGE: Logo Firefox Outline/Vector Result]</td>
</tr>
<tr class="even">
<td>[IMAGE: Logo Messenger Original]</td>
<td>[IMAGE: Logo Messenger Outline/Vector Result]</td>
</tr>
</tbody>
</table>
<p><em>Gambar 4.4 Perbandingan Masukkan dan Keluaran Logo Firefox</em> <em>Gambar 4.5 Perbandingan Masukkan dan Keluaran Logo Messenger App</em></p>
<p><strong>Tabel 4.2 Perbandingan Spesifikasi Logo Firefox dan Logo Messenger</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Metrik</th>
<th style="text-align: left;">Logo Firefox (firefox.png)</th>
<th style="text-align: left;">Logo Messenger (messenger.png)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Dimensi Gambar</td>
<td style="text-align: left;"><span class="math inline">\(1200 \times 1200\)</span> piksel</td>
<td style="text-align: left;"><span class="math inline">\(979 \times 980\)</span> piksel</td>
</tr>
<tr class="even">
<td style="text-align: left;">Total Kontur</td>
<td style="text-align: left;">7</td>
<td style="text-align: left;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total Titik Asli</td>
<td style="text-align: left;">15,370 titik</td>
<td style="text-align: left;">5,132 titik</td>
</tr>
<tr class="even">
<td style="text-align: left;">Total Kurva Bézier</td>
<td style="text-align: left;">88 kurva</td>
<td style="text-align: left;">55 kurva</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Rasio Kompresi</td>
<td style="text-align: left;">1 kurva per 174.66 titik</td>
<td style="text-align: left;">1 kurva per 93.31 titik</td>
</tr>
</tbody>
</table>
<p><strong>Analisis:</strong></p>
<ul>
<li><strong>Efisiensi Representasi:</strong> Efisiensi kompresi yang signifikan tercapai pada pengujian logo Firefox. Dari total lebih dari 15.000 titik kontur, algoritma mampu merekonstruksi citra hanya dengan 88 kurva Bézier. Hal ini mengindikasikan bahwa variasi gradien warna memiliki dampak minimal terhadap efisiensi, di mana satu kurva Bézier rata-rata merepresentasikan sekitar 175 titik kontur.</li>
<li><strong>Kompleksitas vs.&nbsp;Jumlah Kurva:</strong> Jumlah kurva yang dihasilkan berbanding lurus dengan kompleksitas geometri objek. Hal ini terlihat dari perbandingan antara logo Messenger yang bersifat geometris sederhana dan membutuhkan sedikit kurva, dengan logo Firefox yang memiliki detail lekukan tinggi sehingga membutuhkan jumlah kurva yang lebih banyak.</li>
<li><strong>Kualitas Visual:</strong> Secara umum, visualisasi PDF mampu mengaproksimasi gambar asli dengan akurasi tinggi. Namun, keterbatasan terlihat pada logo Firefox, di mana kombinasi gradien warna dan geometri kompleks menyebabkan kegagalan deteksi pada sebagian titik kontur. Akibatnya, hasil rekonstruksi tampak tidak utuh, menandakan perlunya peningkatan algoritma dalam menangani citra dengan kompleksitas warna dan bentuk yang tinggi.</li>
</ul>
<p><strong>C. Kurva yang Berbeda</strong></p>
<p>Kami juga melakukan perbandingan kualitas gambar yang dihasilkan dengan menggunakan banyak kurva yang berbeda pada gambar yang sama. Berikut adalah masukkan, keluaran, dan hasil pemrosesan:</p>
<p><em>Gambar 4.6 Perbandingan Keluaran Makara Terhadap Banyak Kurva</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Output (100 Kurva)</th>
<th>Output (500 Kurva)</th>
<th>Output (800 Kurva)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[IMAGE: Hasil Makara 100 Kurva]</td>
<td>[IMAGE: Hasil Makara 500 Kurva]</td>
<td>[IMAGE: Hasil Makara 800 Kurva]</td>
</tr>
</tbody>
</table>
<p><strong>Tabel 4.2 Perbandingan Spesifikasi Perbedaan Banyak Kurva</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Metrik</th>
<th style="text-align: left;">100 Kurva</th>
<th style="text-align: left;">500 Kurva</th>
<th style="text-align: left;">800 Kurva</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Dimensi Gambar</td>
<td style="text-align: left;"><span class="math inline">\(1890 \times 2065\)</span> piksel</td>
<td style="text-align: left;"><span class="math inline">\(1890 \times 2065\)</span> piksel</td>
<td style="text-align: left;"><span class="math inline">\(1890 \times 2065\)</span> piksel</td>
</tr>
<tr class="even">
<td style="text-align: left;">Total Kontur</td>
<td style="text-align: left;">46</td>
<td style="text-align: left;">46</td>
<td style="text-align: left;">46</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total Titik Asli</td>
<td style="text-align: left;">74,615 titik</td>
<td style="text-align: left;">74,615 titik</td>
<td style="text-align: left;">74,615 titik</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rasio Kompresi</td>
<td style="text-align: left;">1 kurva per 746.15 titik</td>
<td style="text-align: left;">1 kurva per 149.23 titik</td>
<td style="text-align: left;">1 kurva per 93.27 titik</td>
</tr>
</tbody>
</table>
<p><strong>Analisis:</strong></p>
<ul>
<li><strong>Rasio Kompresi vs.&nbsp;Total Kurva:</strong> Terdapat korelasi berbanding terbalik antara jumlah kurva Bézier yang digunakan dengan rasio kompresi titik. Pada konfigurasi 100 kurva, algoritma mencapai efisiensi representasi tertinggi, di mana satu kurva Bézier mampu mengakomodasi rata-rata 746,15 titik data asli. Sebaliknya, ketika jumlah kurva ditingkatkan menjadi 500 dan 800, densitas representasi menurun drastis menjadi masing-masing 149,23 dan 93,27 titik per kurva. Hal ini menunjukkan bahwa penambahan jumlah kurva secara signifikan mengurangi efisiensi penyimpanan data per segmennya.</li>
<li><strong>Kualitas Visual:</strong> Terdapat hubungan berbanding lurus antara jumlah kurva Bézier dengan tingkat akurasi visual yang dihasilkan, namun memiliki batas optimal. Pada visualisasi dengan 100 kurva, algoritma cenderung melakukan generalisasi bentuk (<em>smoothing</em>), di mana detail-detail kecil pada ornamen logo Makara terabaikan demi mencapai rasio kompresi tinggi. Peningkatan ke 500 kurva memperbaiki detail tersebut secara signifikan. Namun, pada penggunaan 800 kurva, meskipun alokasi titik per kurva lebih sedikit (93,27 titik), fleksibilitas yang lebih tinggi ini tidak memberikan perbedaan visual yang signifikan dibandingkan hasil 500 kurva, mengindikasikan terjadinya saturasi kualitas. Hasil eksperimen membuktikan bahwa kualitas visual yang setara dapat dipertahankan dengan jumlah kurva Bézier yang lebih sedikit. Hal ini terkonfirmasi dari hasil rekonstruksi menggunakan 800 kurva yang tidak menunjukkan perbedaan visual signifikan dibandingkan dengan penggunaan 500 kurva. Temuan ini mengindikasikan bahwa kualitas gambar mencapai titik jenuh (<em>saturation point</em>), di mana penambahan kurva melampaui batas optimal tidak lagi memberikan peningkatan kualitas yang nyata.</li>
</ul>
<p><strong>VI. Langkah Pembuatan PDF</strong></p>
<p>Program menulis header <code>%PDF-1.4</code>, mendefinisikan objek Catalog dan Pages, lalu menulis stream yang berisi perintah-perintah grafis. Sesuai spesifikasi, kami menggunakan operator <code>m</code> untuk berpindah ke titik awal kurva dan operator <code>c</code> untuk menggambar kurva Bézier kubik.</p>
<p>Contoh potongan <em>content stream</em>:</p>
<pre class="text"><code>1148.00 188.00 m
1148.47 189.61 1149.94 188.80 1151.00 189.00 c
1195.54 152.40 1241.87 120.11 1292.00 97.00 c
1293.89 95.98 1292.64 93.66 1293.00 92.00 c
1259.48 35.92 1182.23 18.27 1123.00 38.00 c</code></pre>
<p>Ini menggambar kurva dari (1148,188) ke (1151,189) dengan titik kontrol (1148.47,189.61) dan (1149.94,188.80), dan seterusnya.</p>
<hr>
</section>
<section id="kesimpulan" class="level1">
<h1>5. Kesimpulan</h1>
<p>Proyek ini berhasil mengimplementasikan sistem vektorisasi citra menggunakan kurva Bézier. Penggunaan metode <em>Least Squares Fitting</em> dengan pembagian rekursif terbukti efektif untuk menyeimbangkan antara akurasi (galat rendah) dan efisiensi (jumlah kurva minimal). Implementasi <em>Canny Edge Detection</em> meningkatkan ketahanan sistem terhadap variasi input gambar.</p>
<p><strong>Daftar Referensi</strong></p>
<p>Sauer, T. (2012). <em>Numerical Analysis</em> (2nd ed.). Pearson.</p>
<hr>
</section>
<section id="lampiran" class="level1">
<h1>Lampiran</h1>
<p>Complete Source Code: <code>https://github.com/absolutepraya/bezier-curves-python</code></p>
<p><strong>src/main.py</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> image_processor <span class="im">import</span> get_contours</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> curve_fitter <span class="im">import</span> fit_curve_recursive</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pdf_generator <span class="im">import</span> generate_pdf_from_curves</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> main():</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    input_dir <span class="op">=</span> <span class="st">"input"</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    output_dir <span class="op">=</span> <span class="st">"output"</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure output directory exists</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(output_dir):</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>        os.makedirs(output_dir)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1. List images in input directory</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(input_dir):</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error: Directory '</span><span class="sc">{</span>input_dir<span class="sc">}</span><span class="ss">' not found."</span>)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    files <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(input_dir) <span class="cf">if</span> f.lower().endswith((<span class="st">'.png'</span>, <span class="st">'.jpg'</span>, <span class="st">'.jpeg'</span>, <span class="st">'.bmp'</span>))]</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> files:</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"No image files found in '</span><span class="sc">{</span>input_dir<span class="sc">}</span><span class="ss">'."</span>)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Available images:"</span>)</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, f <span class="kw">in</span> <span class="bu">enumerate</span>(files):</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">. </span><span class="sc">{</span>f<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2. User selection</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>            choice <span class="op">=</span> <span class="bu">input</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Select an image number to process: "</span>)</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>            idx <span class="op">=</span> <span class="bu">int</span>(choice) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="dv">0</span> <span class="op">&lt;=</span> idx <span class="op">&lt;</span> <span class="bu">len</span>(files):</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> files[idx]</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">"Invalid selection. Please try again."</span>)</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">ValueError</span>:</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"Please enter a number."</span>)</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    input_path <span class="op">=</span> os.path.join(input_dir, filename)</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 3. Construct output filename</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>    name_without_ext <span class="op">=</span> os.path.splitext(filename)[<span class="dv">0</span>]</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Processing </span><span class="sc">{</span>input_path<span class="sc">}</span><span class="ss">..."</span>)</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get contours</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>        contours, (height, width, _) <span class="op">=</span> get_contours(input_path)</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>        all_curves <span class="op">=</span> []</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>        total_curves_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>        total_points_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fit curves</span></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, contour <span class="kw">in</span> <span class="bu">enumerate</span>(contours):</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>            total_points_count <span class="op">+=</span> <span class="bu">len</span>(contour)</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>            curves <span class="op">=</span> fit_curve_recursive(contour, error_threshold<span class="op">=</span><span class="fl">2.0</span>)</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>            all_curves.append(curves)</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>            total_curves_count <span class="op">+=</span> <span class="bu">len</span>(curves)</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Data Logging</span></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">40</span>)</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"DATA LOGGING SUMMARY"</span>)</span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">40</span>)</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Image Dimensions : </span><span class="sc">{</span>width<span class="sc">}</span><span class="ss">x</span><span class="sc">{</span>height<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Total Contours Found : </span><span class="sc">{</span><span class="bu">len</span>(contours)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Total Original Points : </span><span class="sc">{</span>total_points_count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> total_curves_count <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Total Bezier Curves : </span><span class="sc">{</span>total_curves_count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>            ratio <span class="op">=</span> total_points_count <span class="op">/</span> total_curves_count</span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Compression Ratio : 1 curve per </span><span class="sc">{</span>ratio<span class="sc">:.2f}</span><span class="ss"> points"</span>)</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">40</span>)</span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Generate PDF</span></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>        pdf_output_filename <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>name_without_ext<span class="sc">}</span><span class="ss">-output.pdf"</span></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>        pdf_output_path <span class="op">=</span> os.path.join(output_dir, pdf_output_filename)</span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Generating PDF: </span><span class="sc">{</span>pdf_output_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>        stream_snippet <span class="op">=</span> generate_pdf_from_curves(all_curves, pdf_output_path, width, height)</span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Content Stream Snippet (first 5 lines):"</span>)</span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> line <span class="kw">in</span> stream_snippet:</span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f" </span><span class="sc">{</span>line<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">40</span>)</span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Done!"</span>)</span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>    main()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>src/bezier_math.py</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Point:</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, x, y):</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.x <span class="op">=</span> x</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.y <span class="op">=</span> y</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__add__</span>(<span class="va">self</span>, other):</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Point(<span class="va">self</span>.x <span class="op">+</span> other.x, <span class="va">self</span>.y <span class="op">+</span> other.y)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__sub__</span>(<span class="va">self</span>, other):</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Point(<span class="va">self</span>.x <span class="op">-</span> other.x, <span class="va">self</span>.y <span class="op">-</span> other.y)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__mul__</span>(<span class="va">self</span>, scalar):</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Point(<span class="va">self</span>.x <span class="op">*</span> scalar, <span class="va">self</span>.y <span class="op">*</span> scalar)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__rmul__</span>(<span class="va">self</span>, scalar):</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.<span class="fu">__mul__</span>(scalar)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__truediv__</span>(<span class="va">self</span>, scalar):</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Point(<span class="va">self</span>.x <span class="op">/</span> scalar, <span class="va">self</span>.y <span class="op">/</span> scalar)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__repr__</span>(<span class="va">self</span>):</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f"Point(</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>x<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>y<span class="sc">:.2f}</span><span class="ss">)"</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dist(<span class="va">self</span>, other):</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> math.sqrt((<span class="va">self</span>.x <span class="op">-</span> other.x)<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> (<span class="va">self</span>.y <span class="op">-</span> other.y)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> bernstein_poly(n, i, t):</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculates the Bernstein polynomial B_{i,n}(t).</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># B_{i,n}(t) = C(n,i) * t^i * (1-t)^(n-i)</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">&lt;</span> <span class="dv">0</span> <span class="kw">or</span> i <span class="op">&gt;</span> n:</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    binomial_coeff <span class="op">=</span> math.factorial(n) <span class="op">/</span> (math.factorial(i) <span class="op">*</span> math.factorial(n <span class="op">-</span> i))</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> binomial_coeff <span class="op">*</span> (t<span class="op">**</span>i) <span class="op">*</span> ((<span class="dv">1</span><span class="op">-</span>t)<span class="op">**</span>(n<span class="op">-</span>i))</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cubic_bezier(t, p0, p1, p2, p3):</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Evaluates a cubic Bezier curve at parameter t.</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Returns a Point.</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># B(t) = (1-t)^3 P0 + 3(1-t)^2 t P1 + 3(1-t) t^2 P2 + t^3 P3</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>    b0 <span class="op">=</span> bernstein_poly(<span class="dv">3</span>, <span class="dv">0</span>, t)</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    b1 <span class="op">=</span> bernstein_poly(<span class="dv">3</span>, <span class="dv">1</span>, t)</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    b2 <span class="op">=</span> bernstein_poly(<span class="dv">3</span>, <span class="dv">2</span>, t)</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    b3 <span class="op">=</span> bernstein_poly(<span class="dv">3</span>, <span class="dv">3</span>, t)</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> p0<span class="op">*</span>b0 <span class="op">+</span> p1<span class="op">*</span>b1 <span class="op">+</span> p2<span class="op">*</span>b2 <span class="op">+</span> p3<span class="op">*</span>b3</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> evaluate_curve_length(p0, p1, p2, p3, steps<span class="op">=</span><span class="dv">100</span>):</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Estimates the length of the cubic Bezier curve using numerical integration</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (chord summation).</span></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>    length <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>    prev_point <span class="op">=</span> p0</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, steps <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>        t <span class="op">=</span> i <span class="op">/</span> steps</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>        curr_point <span class="op">=</span> cubic_bezier(t, p0, p1, p2, p3)</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>        length <span class="op">+=</span> prev_point.dist(curr_point)</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>        prev_point <span class="op">=</span> curr_point</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> length</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>src/curve_fitter.py</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bezier_math <span class="im">import</span> Point, cubic_bezier, bernstein_poly</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> chord_length_parameterize(points):</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Parameterizes points based on chord length.</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Returns a list of t values corresponding to each point.</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    u <span class="op">=</span> [<span class="fl">0.0</span>]</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(points)):</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>        dist <span class="op">=</span> points[i].dist(points[i<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>        u.append(u[<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> dist)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    total_length <span class="op">=</span> u[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> total_length <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [<span class="fl">0.0</span>] <span class="op">*</span> <span class="bu">len</span>(points)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [x <span class="op">/</span> total_length <span class="cf">for</span> x <span class="kw">in</span> u]</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fit_cubic_bezier(points):</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fits a single cubic Bezier curve to a set of points using Least Squares.</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># P0 and P3 are fixed as the first and last points.</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># We need to solve for P1 and P2.</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(points)</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span> <span class="co"># Not enough points</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    p0 <span class="op">=</span> points[<span class="dv">0</span>]</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    p3 <span class="op">=</span> points[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Straight Line, place control points at 1/3 and 2/3</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>        p1 <span class="op">=</span> p0<span class="op">*</span>(<span class="dv">2</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span> p3<span class="op">*</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">3</span>)</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>        p2 <span class="op">=</span> p0<span class="op">*</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span> p3<span class="op">*</span>(<span class="dv">2</span><span class="op">/</span><span class="dv">3</span>)</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [p0, p1, p2, p3]</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Parameterize points</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    u <span class="op">=</span> chord_length_parameterize(points)</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># We want to minimize sum || B(u_i) - P_i ||^2</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># B(u) = (1-u)^3 P0 + 3(1-u)^2 u P1 + 3(1-u) u^2 P2 + u^3 P3</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let A1(u) = 3(1-u)^2 u</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let A2(u) = 3(1-u) u^2</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># We want to find P1, P2 such that:</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># A1(u_i) P1 + A2(u_i) P2 = Pi - (1-u_i)^3 P0 - u_i^3 P3</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let X = [P1, P2]^T (conceptually, solving for x and y separately)</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># System of equations:</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># [ sum(A1^2) sum(A1A2) ] [ P1 ] = [ sum(A1*RHS) ]</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># [ sum(A1A2) sum(A2^2) ] [ P2 ]   [ sum(A2*RHS) ]</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>    c11 <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>    c12 <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>    c22 <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>    x1 <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>    x2 <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>    y1 <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>    y2 <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>        t <span class="op">=</span> u[i]</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>        a1 <span class="op">=</span> <span class="dv">3</span> <span class="op">*</span> (<span class="dv">1</span><span class="op">-</span>t)<span class="op">**</span><span class="dv">2</span> <span class="op">*</span> t</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>        a2 <span class="op">=</span> <span class="dv">3</span> <span class="op">*</span> (<span class="dv">1</span><span class="op">-</span>t) <span class="op">*</span> t<span class="op">**</span><span class="dv">2</span></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>        <span class="co"># RHS vector Pi - (1-t)^3 P0 - t^3 P3</span></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>        b0 <span class="op">=</span> (<span class="dv">1</span><span class="op">-</span>t)<span class="op">**</span><span class="dv">3</span></span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>        b3 <span class="op">=</span> t<span class="op">**</span><span class="dv">3</span></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>        rhs <span class="op">=</span> points[i] <span class="op">-</span> (p0 <span class="op">*</span> b0) <span class="op">-</span> (p3 <span class="op">*</span> b3)</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>        c11 <span class="op">+=</span> a1 <span class="op">*</span> a1</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>        c12 <span class="op">+=</span> a1 <span class="op">*</span> a2</span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>        c22 <span class="op">+=</span> a2 <span class="op">*</span> a2</span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>        x1 <span class="op">+=</span> a1 <span class="op">*</span> rhs.x</span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>        x2 <span class="op">+=</span> a2 <span class="op">*</span> rhs.x</span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>        y1 <span class="op">+=</span> a1 <span class="op">*</span> rhs.y</span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>        y2 <span class="op">+=</span> a2 <span class="op">*</span> rhs.y</span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Determinant of the matrix</span></span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>    det <span class="op">=</span> c11 <span class="op">*</span> c22 <span class="op">-</span> c12 <span class="op">*</span> c12</span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">abs</span>(det) <span class="op">&lt;</span> <span class="fl">1e-9</span>:</span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Singular matrix, fallback to straight Line approximation</span></span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>        p1 <span class="op">=</span> p0<span class="op">*</span>(<span class="dv">2</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span> p3<span class="op">*</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">3</span>)</span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a>        p2 <span class="op">=</span> p0<span class="op">*</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span> p3<span class="op">*</span>(<span class="dv">2</span><span class="op">/</span><span class="dv">3</span>)</span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [p0, p1, p2, p3]</span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Inverse matrix multiplication</span></span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a>    <span class="co"># [P1] = (1/det) [ c22 -c12 ] [X1]</span></span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a>    <span class="co"># [P2]           [ -c12 c11 ] [X2]</span></span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a>    p1_x <span class="op">=</span> (c22 <span class="op">*</span> x1 <span class="op">-</span> c12 <span class="op">*</span> x2) <span class="op">/</span> det</span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a>    p2_x <span class="op">=</span> (<span class="op">-</span>c12 <span class="op">*</span> x1 <span class="op">+</span> c11 <span class="op">*</span> x2) <span class="op">/</span> det</span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a>    p1_y <span class="op">=</span> (c22 <span class="op">*</span> y1 <span class="op">-</span> c12 <span class="op">*</span> y2) <span class="op">/</span> det</span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a>    p2_y <span class="op">=</span> (<span class="op">-</span>c12 <span class="op">*</span> y1 <span class="op">+</span> c11 <span class="op">*</span> y2) <span class="op">/</span> det</span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> Point(p1_x, p1_y)</span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> Point(p2_x, p2_y)</span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [p0, p1, p2, p3]</span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_max_error(points, curve):</span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculates the maximum distance between the points and the fitted curve.</span></span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a>    u <span class="op">=</span> chord_length_parameterize(points)</span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a>    max_dist <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(points)):</span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a>        p_curve <span class="op">=</span> cubic_bezier(u[i], curve[<span class="dv">0</span>], curve[<span class="dv">1</span>], curve[<span class="dv">2</span>], curve[<span class="dv">3</span>])</span>
<span id="cb6-107"><a href="#cb6-107" aria-hidden="true" tabindex="-1"></a>        dist <span class="op">=</span> points[i].dist(p_curve)</span>
<span id="cb6-108"><a href="#cb6-108" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> dist <span class="op">&gt;</span> max_dist:</span>
<span id="cb6-109"><a href="#cb6-109" aria-hidden="true" tabindex="-1"></a>            max_dist <span class="op">=</span> dist</span>
<span id="cb6-110"><a href="#cb6-110" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> max_dist</span>
<span id="cb6-111"><a href="#cb6-111" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-112"><a href="#cb6-112" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fit_curve_recursive(points, error_threshold<span class="op">=</span><span class="fl">2.0</span>):</span>
<span id="cb6-113"><a href="#cb6-113" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Recursively fits Bezier curves to the points.</span></span>
<span id="cb6-114"><a href="#cb6-114" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If the error is too large, splits the points and fits again.</span></span>
<span id="cb6-115"><a href="#cb6-115" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-116"><a href="#cb6-116" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(points) <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb6-117"><a href="#cb6-117" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> []</span>
<span id="cb6-118"><a href="#cb6-118" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-119"><a href="#cb6-119" aria-hidden="true" tabindex="-1"></a>    curve <span class="op">=</span> fit_cubic_bezier(points)</span>
<span id="cb6-120"><a href="#cb6-120" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> curve <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb6-121"><a href="#cb6-121" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> []</span>
<span id="cb6-122"><a href="#cb6-122" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-123"><a href="#cb6-123" aria-hidden="true" tabindex="-1"></a>    max_err <span class="op">=</span> calculate_max_error(points, curve)</span>
<span id="cb6-124"><a href="#cb6-124" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-125"><a href="#cb6-125" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> max_err <span class="op">&lt;</span> error_threshold <span class="kw">or</span> <span class="bu">len</span>(points) <span class="op">&lt;</span> <span class="dv">4</span>:</span>
<span id="cb6-126"><a href="#cb6-126" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [curve]</span>
<span id="cb6-127"><a href="#cb6-127" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-128"><a href="#cb6-128" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Split points at the point of maximum error</span></span>
<span id="cb6-129"><a href="#cb6-129" aria-hidden="true" tabindex="-1"></a>    <span class="co"># To find the split index, we re-evaluate distances</span></span>
<span id="cb6-130"><a href="#cb6-130" aria-hidden="true" tabindex="-1"></a>    u <span class="op">=</span> chord_length_parameterize(points)</span>
<span id="cb6-131"><a href="#cb6-131" aria-hidden="true" tabindex="-1"></a>    max_dist <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb6-132"><a href="#cb6-132" aria-hidden="true" tabindex="-1"></a>    split_idx <span class="op">=</span> <span class="bu">len</span>(points) <span class="op">//</span> <span class="dv">2</span> <span class="co"># Default split</span></span>
<span id="cb6-133"><a href="#cb6-133" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-134"><a href="#cb6-134" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(points)):</span>
<span id="cb6-135"><a href="#cb6-135" aria-hidden="true" tabindex="-1"></a>        p_curve <span class="op">=</span> cubic_bezier(u[i], curve[<span class="dv">0</span>], curve[<span class="dv">1</span>], curve[<span class="dv">2</span>], curve[<span class="dv">3</span>])</span>
<span id="cb6-136"><a href="#cb6-136" aria-hidden="true" tabindex="-1"></a>        dist <span class="op">=</span> points[i].dist(p_curve)</span>
<span id="cb6-137"><a href="#cb6-137" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> dist <span class="op">&gt;</span> max_dist:</span>
<span id="cb6-138"><a href="#cb6-138" aria-hidden="true" tabindex="-1"></a>            max_dist <span class="op">=</span> dist</span>
<span id="cb6-139"><a href="#cb6-139" aria-hidden="true" tabindex="-1"></a>            split_idx <span class="op">=</span> i</span>
<span id="cb6-140"><a href="#cb6-140" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-141"><a href="#cb6-141" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure we don't split at endpoints</span></span>
<span id="cb6-142"><a href="#cb6-142" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> split_idx <span class="op">==</span> <span class="dv">0</span>: split_idx <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb6-143"><a href="#cb6-143" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> split_idx <span class="op">==</span> <span class="bu">len</span>(points) <span class="op">-</span> <span class="dv">1</span>: split_idx <span class="op">=</span> <span class="bu">len</span>(points) <span class="op">-</span> <span class="dv">2</span></span>
<span id="cb6-144"><a href="#cb6-144" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-145"><a href="#cb6-145" aria-hidden="true" tabindex="-1"></a>    left_points <span class="op">=</span> points[:split_idx<span class="op">+</span><span class="dv">1</span>]</span>
<span id="cb6-146"><a href="#cb6-146" aria-hidden="true" tabindex="-1"></a>    right_points <span class="op">=</span> points[split_idx:]</span>
<span id="cb6-147"><a href="#cb6-147" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-148"><a href="#cb6-148" aria-hidden="true" tabindex="-1"></a>    left_curves <span class="op">=</span> fit_curve_recursive(left_points, error_threshold)</span>
<span id="cb6-149"><a href="#cb6-149" aria-hidden="true" tabindex="-1"></a>    right_curves <span class="op">=</span> fit_curve_recursive(right_points, error_threshold)</span>
<span id="cb6-150"><a href="#cb6-150" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-151"><a href="#cb6-151" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> left_curves <span class="op">+</span> right_curves</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>src/image_processor.py</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bezier_math <span class="im">import</span> Point</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_contours(image_path, min_area<span class="op">=</span><span class="dv">100</span>):</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loads an image, processes it, and extracts contours.</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Returns a list of contours, where each contour is a list of Point objects.</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1. Load image</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    img <span class="op">=</span> cv2.imread(image_path)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> img <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">FileNotFoundError</span>(<span class="ss">f"Could not load image at </span><span class="sc">{</span>image_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2. Convert to grayscale</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    gray <span class="op">=</span> cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 3. Edge Detection (Canny)</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Canny is more robust for finding edges regardless of brightness direction.</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># We use standard thresholds 100 and 200.</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    edges <span class="op">=</span> cv2.Canny(img, <span class="dv">100</span>, <span class="dv">200</span>)</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 4. Find contours</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># RETR_EXTERNAL retrieves only the extreme outer contours.</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># RETR_LIST retrieves all contours.</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># CHAIN_APPROX_NONE stores all the contour points (no approximation).</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    contours, _ <span class="op">=</span> cv2.findContours(edges, cv2.RETR_LIST, cv2.CHAIN_APPROX_NONE)</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    processed_contours <span class="op">=</span> []</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> cnt <span class="kw">in</span> contours:</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Filter small noise</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> cv2.contourArea(cnt) <span class="op">&lt;</span> min_area:</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Convert numpy array (N, 1, 2) to List of Points</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Note: cv2 points are (x, y), and image coordinates have y growing downwards.</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>        <span class="co"># We keep this coordinate system for now (PDF also has y, but usually growing upwards,</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># we might need to flip y later or in the PDF generator).</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>        points <span class="op">=</span> []</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> cnt:</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>            x, y <span class="op">=</span> p[<span class="dv">0</span>]</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>            points.append(Point(<span class="bu">float</span>(x), <span class="bu">float</span>(y)))</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>        processed_contours.append(points)</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> processed_contours, img.shape</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>src/pdf_generator.py</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PDFGenerator:</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, filename, width, height):</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.filename <span class="op">=</span> filename</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.width <span class="op">=</span> width</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.height <span class="op">=</span> height</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.objects <span class="op">=</span> []</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.content_stream <span class="op">=</span> []</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_object(<span class="va">self</span>, content):</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        obj_id <span class="op">=</span> <span class="bu">len</span>(<span class="va">self</span>.objects) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.objects.append(content)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> obj_id</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_curve(<span class="va">self</span>, p0, p1, p2, p3):</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># PDF coordinates usually start from bottom-Left.</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If our image coordinates are top-left, we might need to flip Y.</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># For now, we assume the points are already in the desired coordinate system</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># or we flip them here. Let's flip them here assuming input is image coords (y down).</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>        h <span class="op">=</span> <span class="va">self</span>.height</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Move to P0</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.content_stream.append(<span class="ss">f"</span><span class="sc">{</span>p0<span class="sc">.</span>x<span class="sc">:.2f}</span><span class="ss"> </span><span class="sc">{</span>h <span class="op">-</span> p0<span class="sc">.</span>y<span class="sc">:.2f}</span><span class="ss"> m"</span>)</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Curve to P3 via P1, P2</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.content_stream.append(<span class="ss">f"</span><span class="sc">{</span>p1<span class="sc">.</span>x<span class="sc">:.2f}</span><span class="ss"> </span><span class="sc">{</span>h <span class="op">-</span> p1<span class="sc">.</span>y<span class="sc">:.2f}</span><span class="ss"> </span><span class="sc">{</span>p2<span class="sc">.</span>x<span class="sc">:.2f}</span><span class="ss"> </span><span class="sc">{</span>h <span class="op">-</span> p2<span class="sc">.</span>y<span class="sc">:.2f}</span><span class="ss"> </span><span class="sc">{</span>p3<span class="sc">.</span>x<span class="sc">:.2f}</span><span class="ss"> </span><span class="sc">{</span>h <span class="op">-</span> p3<span class="sc">.</span>y<span class="sc">:.2f}</span><span class="ss"> c"</span>)</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_stroke(<span class="va">self</span>):</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.content_stream.append(<span class="st">"S"</span>)</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_fill(<span class="va">self</span>):</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.content_stream.append(<span class="st">"f"</span>)</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> generate(<span class="va">self</span>):</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 1. Header</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>        pdf_content <span class="op">=</span> <span class="st">"%PDF-1.4</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 2. Objects</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>        offsets <span class="op">=</span> []</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Object 1: Catalog</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>        offsets.append(<span class="bu">len</span>(pdf_content))</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>        pdf_content <span class="op">+=</span> <span class="st">"1 0 obj</span><span class="ch">\n</span><span class="st">&lt;&lt; /Type /Catalog /Pages 2 0 R &gt;&gt;</span><span class="ch">\n</span><span class="st">endobj</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Object 2: Pages</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>        offsets.append(<span class="bu">len</span>(pdf_content))</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>        pdf_content <span class="op">+=</span> <span class="st">"2 0 obj</span><span class="ch">\n</span><span class="st">&lt;&lt; /Type /Pages /Kids [3 0 R] /Count 1 &gt;&gt;</span><span class="ch">\n</span><span class="st">endobj</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Object 3: Page</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>        offsets.append(<span class="bu">len</span>(pdf_content))</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>        pdf_content <span class="op">+=</span> <span class="ss">f"3 0 obj</span><span class="ch">\n</span><span class="ss">&lt;&lt; /Type /Page /Parent 2 0 R /MediaBox [0 0 </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>width<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>height<span class="sc">}</span><span class="ss">] /Contents 4 0 R &gt;&gt;</span><span class="ch">\n</span><span class="ss">endobj</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Object 4: Content Stream</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>        stream_data <span class="op">=</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(<span class="va">self</span>.content_stream)</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>        stream_len <span class="op">=</span> <span class="bu">len</span>(stream_data)</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>        offsets.append(<span class="bu">len</span>(pdf_content))</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>        pdf_content <span class="op">+=</span> <span class="ss">f"4 0 obj</span><span class="ch">\n</span><span class="ss">&lt;&lt; /Length </span><span class="sc">{</span>stream_len<span class="sc">}</span><span class="ss"> &gt;&gt;</span><span class="ch">\n</span><span class="ss">stream</span><span class="ch">\n</span><span class="sc">{</span>stream_data<span class="sc">}</span><span class="ch">\n</span><span class="ss">endstream</span><span class="ch">\n</span><span class="ss">endobj</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 3. Xref</span></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>        xref_start <span class="op">=</span> <span class="bu">len</span>(pdf_content)</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>        pdf_content <span class="op">+=</span> <span class="st">"xref</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>        pdf_content <span class="op">+=</span> <span class="ss">f"0 </span><span class="sc">{</span><span class="bu">len</span>(offsets) <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>        pdf_content <span class="op">+=</span> <span class="st">"0000000000 65535 f </span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> offset <span class="kw">in</span> offsets:</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>            pdf_content <span class="op">+=</span> <span class="ss">f"</span><span class="sc">{</span>offset<span class="sc">:010d}</span><span class="ss"> 00000 n </span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 4. Trailer</span></span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>        pdf_content <span class="op">+=</span> <span class="st">"trailer</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>        pdf_content <span class="op">+=</span> <span class="ss">f"&lt;&lt; /Size </span><span class="sc">{</span><span class="bu">len</span>(offsets) <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss"> /Root 1 0 R &gt;&gt;</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>        pdf_content <span class="op">+=</span> <span class="st">"startxref</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>        pdf_content <span class="op">+=</span> <span class="ss">f"</span><span class="sc">{</span>xref_start<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>        pdf_content <span class="op">+=</span> <span class="st">"</span><span class="sc">%%</span><span class="st">EOF"</span></span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(<span class="va">self</span>.filename, <span class="st">'w'</span>) <span class="im">as</span> f:</span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>            f.write(pdf_content)</span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_pdf_from_curves(curves, output_filename, width, height):</span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>    pdf <span class="op">=</span> PDFGenerator(output_filename, width, height)</span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># We can group curves that are connected, but for simplicity</span></span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># we can just treat each curve as a sub-path.</span></span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ideally, we should detect closed Loops for filling.</span></span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The 'curves' input is a list of lists of curves (one List per contour).</span></span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> contour_curves <span class="kw">in</span> curves:</span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> contour_curves:</span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Start path</span></span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>        p0 <span class="op">=</span> contour_curves[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a>        h <span class="op">=</span> height</span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a>        pdf.content_stream.append(<span class="ss">f"</span><span class="sc">{</span>p0<span class="sc">.</span>x<span class="sc">:.2f}</span><span class="ss"> </span><span class="sc">{</span>h <span class="op">-</span> p0<span class="sc">.</span>y<span class="sc">:.2f}</span><span class="ss"> m"</span>)</span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> curve <span class="kw">in</span> contour_curves:</span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a>            <span class="co"># curve is [p0, p1, p2, p3]</span></span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a>            <span class="co"># We assume p0 of this curve is p3 of previous, so we just issue 'c'</span></span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a>            p1, p2, p3 <span class="op">=</span> curve[<span class="dv">1</span>], curve[<span class="dv">2</span>], curve[<span class="dv">3</span>]</span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a>            pdf.content_stream.append(<span class="ss">f"</span><span class="sc">{</span>p1<span class="sc">.</span>x<span class="sc">:.2f}</span><span class="ss"> </span><span class="sc">{</span>h <span class="op">-</span> p1<span class="sc">.</span>y<span class="sc">:.2f}</span><span class="ss"> </span><span class="sc">{</span>p2<span class="sc">.</span>x<span class="sc">:.2f}</span><span class="ss"> </span><span class="sc">{</span>h <span class="op">-</span> p2<span class="sc">.</span>y<span class="sc">:.2f}</span><span class="ss"> </span><span class="sc">{</span>p3<span class="sc">.</span>x<span class="sc">:.2f}</span><span class="ss"> </span><span class="sc">{</span>h <span class="op">-</span> p3<span class="sc">.</span>y<span class="sc">:.2f}</span><span class="ss"> c"</span>)</span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Close and stroke/fill</span></span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a>        <span class="co"># For now, Let's just stroke.</span></span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a>        pdf.add_stroke()</span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a>    pdf.generate()</span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return a snippet of the content stream for Logging</span></span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pdf.content_stream[:<span class="dv">5</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>